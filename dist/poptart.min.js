/*! Poptart - v0.1.0 - 2013-05-17
* https://github.com/servo/poptart
* Copyright (c) 2013 Otter; Licensed MIT, GPL */
(function(){"use strict";var a={},b=null;window.onpopstate=function(b){b.state&&a.hasOwnProperty(b.state.page)&&f(a[b.state.page],function(){this(b.state)})};var c=function(a){typeof a=="str"?b=a:b=window.location.protocol+"//"+window.location.host+window.location.pathname},d=function(a){var c=a.replace(b,"");return b+c},e=function(a){return document.getElementsByTagName(a)},f=function(a,b){for(var c=0;c<a.length;c+=1)b.call(a[c],c)},g=function(b,c){a.hasOwnProperty(b)||(a[b]=[]),a[b].push(c)},h=function(a,b,c){history.pushState(a,b,c)},i=function(b,c){if(!a.hasOwnProperty(b))return!1;f(a[b],function(){this(c)})},j=function(a,b){var c={};return window.XMLHttpRequest?c=new XMLHttpRequest:window.ActiveXObject&&(c=new window.ActiveXObject("Microsoft.XMLHTTP")),c.open("post",a,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.onreadystatechange=function(a){c.readyState===4&&(c.status===200||c.status===301?(b.response=c.response,h(b,b.title,b.href),i(b.page,b)):window.console.log("error getting ajax"))},c.send()},k=function(){};k.prototype={init:function(){c(),h({page:"poptart_base",index:null,title:"default title",href:b,response:null},"default",b),f(e("a"),function(a){var b=this.href;this.href=d(b),this.onclick=function(c){c.preventDefault();var d={page:b,index:a,title:this.title,href:this.href,response:null},e=j(d.href,d)}})},set:function(a,b){a.indexOf("/")!==0?g(d(a),b):g(d(a.replace("/","")),b)},base:function(a){g("poptart_base",a)},getCallbacks:function(b){return typeof b=="string"&&a.hasOwnProperty(b)?a[b]:a}},window.poptart=new k})();